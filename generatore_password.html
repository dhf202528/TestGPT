<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Generatore di Password</title>
  <style>
    :root{
      --bg:#0f1222;
      --card:#171a2e;
      --muted:#9aa3b2;
      --text:#e7eaf3;
      --accent:#7aa2ff;
      --accent-2:#8affc1;
      --danger:#ff6b6b;
      --ok:#7dffaa;
      --shadow:0 10px 30px rgba(0,0,0,.35);
      --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      background: radial-gradient(1200px 800px at 10% -10%, #1a2040 0, #0b0f1f 60%, #080b18 100%);
      color:var(--text);
      font:16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji";
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
    }
    .wrap{
      width: min(980px, 100%);
      display:grid;
      gap:18px;
      grid-template-columns: 1.1fr .9fr;
    }
    @media (max-width: 840px){
      .wrap{grid-template-columns: 1fr}
    }
    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      backdrop-filter: blur(6px);
      border:1px solid rgba(255,255,255,.06);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:18px;
    }
    h1{
      margin:0 0 8px 0;
      font-weight:700;
      letter-spacing:.2px;
      font-size: clamp(22px, 3vw, 28px);
    }
    p.sub{
      margin:0 0 10px;
      color:var(--muted);
      font-size:14px;
    }
    .out{
      display:flex; gap:8px; align-items:center;
      background:#0c1023;
      border:1px solid rgba(255,255,255,.08);
      padding:12px;
      border-radius:14px;
    }
    .out input{
      flex:1;
      background:transparent;
      color:var(--text);
      border:0; outline:0;
      font:600 18px/1.2 ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      letter-spacing:.5px;
    }
    .btn{
      all:unset;
      cursor:pointer;
      padding:10px 14px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.10);
      background:linear-gradient(180deg, rgba(122,162,255,.15), rgba(122,162,255,.08));
      transition:.2s transform ease, .2s filter ease;
      user-select:none;
    }
    .btn:hover{ transform: translateY(-1px) }
    .btn:active{ transform: translateY(0) scale(.98) }
    .btn.secondary{
      background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
    }
    .controls{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    .row{display:flex; gap:10px; align-items:center; justify-content:space-between}
    .seg{
      display:grid;
      grid-template-columns: repeat(4,1fr);
      gap:8px;
    }
    .seg input{display:none}
    .seg label{
      text-align:center;
      padding:10px 8px;
      border:1px solid rgba(255,255,255,.08);
      border-radius:12px;
      cursor:pointer;
      font-weight:600;
      color:var(--muted);
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
    }
    .seg input:checked + label{
      color: var(--text);
      border-color: rgba(122,162,255,.6);
      box-shadow: inset 0 0 0 1px rgba(122,162,255,.6), 0 0 0 4px rgba(122,162,255,.1);
      background:linear-gradient(180deg, rgba(122,162,255,.16), rgba(122,162,255,.1));
    }
    .stack{display:grid; gap:8px}
    fieldset{
      border:1px solid rgba(255,255,255,.08);
      border-radius:14px;
      padding:12px;
      margin:0;
    }
    fieldset legend{
      color:var(--muted);
      font-size:12px;
      padding:0 6px;
    }
    .chk{ display:flex; gap:8px; align-items:center; }
    .chk input{ width:18px; height:18px }
    .meter{
      height:10px; width:100%;
      background: #0c1023;
      border:1px solid rgba(255,255,255,.08);
      border-radius:999px;
      overflow:hidden;
    }
    .bar{height:100%; width:0%}
    .tag{
      display:inline-block; font-size:12px;
      color:#0b0f1f; background:var(--ok);
      padding:2px 8px; border-radius:999px; font-weight:700;
    }
    .muted{ color:var(--muted); font-size:12px }
    .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    .grid-2{ display:grid; grid-template-columns:1fr 1fr; gap:12px }
    .foot{ color:var(--muted); font-size:12px; text-align:center; margin-top:10px }
    .note{ color:var(--muted); font-size:13px }
    .danger{ color:var(--danger) }
  </style>
</head>
<body>
  <div class="wrap">
    <section class="card">
      <h1>Generatore di Password</h1>
      <p class="sub">Scegli il livello, imposta la lunghezza e genera. Copia con un clic. (Niente scuse per "123456" ðŸ˜‰)</p>

      <div class="out">
        <input id="pwd" type="text" placeholder="Premi Generaâ€¦" readonly />
        <button id="copyBtn" class="btn secondary" title="Copia negli appunti">Copia</button>
        <button id="toggleBtn" class="btn secondary" title="Mostra/Nascondi password">Mostra</button>
      </div>

      <div class="controls card" style="padding:12px; margin-top:12px">
        <div class="stack">
          <div class="seg">
            <input type="radio" name="level" id="easy" value="easy" checked>
            <label for="easy">Facile</label>
            <input type="radio" name="level" id="medium" value="medium">
            <label for="medium">Media</label>
            <input type="radio" name="level" id="strong" value="strong">
            <label for="strong">Forte</label>
            <input type="radio" name="level" id="custom" value="custom">
            <label for="custom">Personalizzata</label>
          </div>

          <div class="row">
            <label for="length">Lunghezza: <span id="lenVal" class="tag">12</span></label>
            <input id="length" type="range" min="6" max="64" value="12">
          </div>

          <fieldset id="customBox" style="display:none;">
            <legend>Opzioni personalizzate</legend>
            <div class="grid-2">
              <label class="chk"><input id="useLower" type="checkbox" checked> Lettere minuscole (aâ€“z)</label>
              <label class="chk"><input id="useUpper" type="checkbox" checked> Lettere maiuscole (Aâ€“Z)</label>
              <label class="chk"><input id="useNums"  type="checkbox" checked> Numeri (0â€“9)</label>
              <label class="chk"><input id="useSyms"  type="checkbox" checked> Simboli (!@#â€¦)</label>
              <label class="chk"><input id="noAmb"    type="checkbox"> Evita caratteri ambigui (0/O, 1/l/I)</label>
              <label class="chk"><input id="requireAll" type="checkbox" checked> Richiedi almeno 1 per tipo selezionato</label>
            </div>
          </fieldset>
        </div>

        <div class="stack">
          <div class="row">
            <button id="genBtn" class="btn">Genera</button>
            <span class="note">Suggerimento: usa <span class="mono">Forte</span> per account critici.</span>
          </div>

          <div class="stack card" style="padding:12px">
            <div class="row" style="gap:10px">
              <div class="meter"><div id="bar" class="bar"></div></div>
              <span id="label" class="tag">Debole</span>
            </div>
            <div class="row" style="margin-top:6px">
              <span class="muted">Stima entropia:</span>
              <span id="entropy" class="mono">0 bit</span>
            </div>
          </div>

          <ul class="muted" style="margin:0 0 0 16px; padding:0; list-style:disc">
            <li>Facile: lettere minuscole + numeri, 10â€“12 caratteri</li>
            <li>Media: minuscole/maiuscole/numeri, 12â€“14 caratteri</li>
            <li>Forte: tutti i set, 16â€“24 caratteri, evita ambigui</li>
          </ul>
        </div>
      </div>

      <p class="foot">Local-first, zero tracking. La complessitÃ  Ã¨ stimata, non Ã¨ un audit di sicurezza.</p>
    </section>

    <aside class="card">
      <h2 style="margin-top:0">Come funziona</h2>
      <ol class="muted" style="padding-left:18px; margin-top:6px">
        <li>Seleziona il livello o scegli <b>Personalizzata</b>.</li>
        <li>Regola la <b>lunghezza</b>.</li>
        <li>Clicca <b>Genera</b> e poi <b>Copia</b>.</li>
      </ol>
      <p class="muted">Il misuratore calcola una stima basata su <i>entropia</i> â‰ˆ log<sub>2</sub>(|alfabeto|<sup>n</sup>) = nÂ·log<sub>2</sub>|alfabeto|.</p>
      <p class="muted">Esempio: 16 caratteri con 72 simboli possibili â‰ˆ <span class="mono">16 Â· log2(72) â‰ˆ 101 bit</span>.</p>
      <p class="muted">PiÃ¹ bit â‰ˆ password piÃ¹ resistente agli attacchi di forza bruta.</p>
      <p class="muted">Consiglio operativo: usa un <b>password manager</b> e <b>2FA</b>. Il futuro te ti ringrazierÃ .</p>
    </aside>
  </div>

  <script>
    const el = id => document.getElementById(id);

    const sets = {
      lower: "abcdefghjkmnpqrstuvwxyz",
      upper: "ABCDEFGHJKMNPQRSTUVWXYZ",
      nums:  "23456789",
      syms:  "!@#$%^&*()-_=+[]{};:,.?/"
    };
    const ambiguous = "0O1lI|`~'\"\\<>";
    const fullSets = {
      lower: "abcdefghijklmnopqrstuvwxyz",
      upper: "ABCDEFGHIJKLMNOPQRSTUVWXYZ",
      nums:  "0123456789",
      syms:  "!@#$%^&*()-_=+[]{};:,.?/"
    };

    const pwd = el('pwd');
    const copyBtn = el('copyBtn');
    const toggleBtn = el('toggleBtn');
    const genBtn = el('genBtn');
    const lenRange = el('length');
    const lenVal = el('lenVal');
    const bar = el('bar');
    const label = el('label');
    const entropyEl = el('entropy');
    const customBox = el('customBox');

    const opt = {
      get level(){ return document.querySelector('input[name="level"]:checked').value; },
      get custom(){
        return {
          lower: el('useLower').checked,
          upper: el('useUpper').checked,
          nums:  el('useNums').checked,
          syms:  el('useSyms').checked,
          noAmb: el('noAmb').checked,
          requireAll: el('requireAll').checked
        };
      }
    };

    function updateLenByLevel(){
      const lvl = opt.level;
      if(lvl === 'easy'){
        lenRange.value = 12;
      } else if(lvl === 'medium'){
        lenRange.value = 13;
      } else if(lvl === 'strong'){
        lenRange.value = 18;
      }
      lenVal.textContent = lenRange.value;
      customBox.style.display = (lvl === 'custom') ? 'block' : 'none';
    }

    function buildAlphabet(level){
      let alphabet = "";
      let requireAll = false;
      let groups = [];

      if(level === 'easy'){
        alphabet = fullSets.lower + fullSets.nums;
        groups = [fullSets.lower, fullSets.nums];
        requireAll = true;
      } else if(level === 'medium'){
        alphabet = fullSets.lower + fullSets.upper + fullSets.nums;
        groups = [fullSets.lower, fullSets.upper, fullSets.nums];
        requireAll = true;
      } else if(level === 'strong'){
        alphabet = fullSets.lower + fullSets.upper + fullSets.nums + fullSets.syms;
        alphabet = alphabet.split("").filter(c => !ambiguous.includes(c)).join("");
        groups = [fullSets.lower, fullSets.upper, fullSets.nums, fullSets.syms];
        requireAll = true;
      } else { // custom
        const c = opt.custom;
        if(c.lower) groups.push(fullSets.lower);
        if(c.upper) groups.push(fullSets.upper);
        if(c.nums)  groups.push(fullSets.nums);
        if(c.syms)  groups.push(fullSets.syms);
        alphabet = groups.join("");
        if(c.noAmb){
          alphabet = alphabet.split("").filter(ch => !ambiguous.includes(ch)).join("");
        }
        requireAll = c.requireAll;
      }
      return { alphabet, groups, requireAll };
    }

    function cryptoRandom(max){
      const arr = new Uint32Array(1);
      window.crypto.getRandomValues(arr);
      return arr[0] % max;
    }

    function shuffle(array){
      for(let i = array.length - 1; i > 0; i--){
        const j = cryptoRandom(i + 1);
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    function generate(){
      const level = opt.level;
      const length = parseInt(lenRange.value, 10);
      const { alphabet, groups, requireAll } = buildAlphabet(level);

      if(alphabet.length === 0){
        alert("Seleziona almeno un insieme di caratteri.");
        return "";
      }

      const chars = [];
      // Garantisci almeno 1 carattere per gruppo (se richiesto)
      if(requireAll){
        for(const g of groups){
          chars.push(g[cryptoRandom(g.length)]);
        }
      }

      while(chars.length < length){
        chars.push(alphabet[cryptoRandom(alphabet.length)]);
      }

      shuffle(chars);
      const result = chars.slice(0, length).join("");
      return result;
    }

    function estimateEntropy(pw, alphabetSize){
      if(!pw) return 0;
      return Math.round(pw.length * Math.log2(alphabetSize));
    }

    function updateMeter(pw, alphabetSize){
      const bits = estimateEntropy(pw, alphabetSize);
      entropyEl.textContent = bits + " bit";

      let pct = Math.min(100, Math.round((bits / 120) * 100)); // 120 bit â‰ˆ ottimo per uso comune
      bar.style.width = pct + "%";
      bar.style.background = `linear-gradient(90deg, #ff6b6b, #ffd36b, #8affc1)`;

      let lab = "Debole";
      if(bits >= 50) lab = "Discreta";
      if(bits >= 80) lab = "Buona";
      if(bits >= 100) lab = "Ottima";
      if(bits >= 130) lab = "Eccellente";
      label.textContent = lab;
    }

    function computeAlphabetSize(level){
      const { alphabet } = buildAlphabet(level);
      return new Set(alphabet).size;
    }

    // Events
    document.querySelectorAll('input[name="level"]').forEach(r => {
      r.addEventListener('change', () => { updateLenByLevel(); pwd.value = ""; updateMeter("", 1); });
    });
    lenRange.addEventListener('input', () => lenVal.textContent = lenRange.value);
    document.getElementById('customBox').addEventListener('input', () => { pwd.value = ""; updateMeter("", 1); });

    genBtn.addEventListener('click', () => {
      const pw = generate();
      pwd.value = pw;
      updateMeter(pw, computeAlphabetSize(opt.level));
    });

    copyBtn.addEventListener('click', async () => {
      if(!pwd.value) return;
      try{
        await navigator.clipboard.writeText(pwd.value);
        copyBtn.textContent = "Copiato!";
        setTimeout(() => copyBtn.textContent = "Copia", 1200);
      }catch(e){
        // Fallback
        pwd.select(); document.execCommand('copy');
        copyBtn.textContent = "Copiato!";
        setTimeout(() => copyBtn.textContent = "Copia", 1200);
      }
    });

    let hidden = true;
    toggleBtn.addEventListener('click', () => {
      hidden = !hidden;
      pwd.type = hidden ? "text" : "password"; // invertito apposta per consentire selezione facile
      toggleBtn.textContent = hidden ? "Mostra" : "Nascondi";
    });

    // init
    updateLenByLevel();
    updateMeter("", 1);
  </script>
</body>
</html>
